//*********************************************************************************************************************************************************************************
// nws_prompt_control.c
/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 * Release Information.
 *---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 *
 * Version:		N-C7 	   - v090
 * Date:		01/10/2020
 * Modifier:	Emilio R. La Greca
 *
 * Original release.
 *
 *-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

#include		<com_defn.h>
#include		<nws_prompt_common.h>
#include		<gentimdt.h>

#if (BUILD_INFO__NCX_DEVICE == COM_DEFN__NCX_DEVICE__NC7)
#include		<nws_prompt_userif_NC7.h>
#endif

//*********************************************************************************************************************************************************************************
// MODULE
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// CONSTANTS
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#define		NWS_PROMPT_CONTROL__AUTO_EXIT_DELAY_INTERVAL_1S		60
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// VARIABLES
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
static NWS_PROMPT_COMMON__ControlDetails	mInfoPrompt;
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// SAVED VALUES
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
//
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// TIMING
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
const struct	GENTIMDT__Timing		NWS_PROMPT_CONTROL__kInfoPromptAutoExitDelayTiming = { &mInfoPrompt.AutoExitDelayTimingCounter };
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// FUNCTION DECLARES
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
//
//*********************************************************************************************************************************************************************************


//*********************************************************************************************************************************************************************************
// APPLICATION
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// VARIABLES
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
//
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// FUNCTION DEFINITIONS
/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 * @brief:	Initialises data ready for processing once this state is entered.
 * @param:	None.
 * @retval:	None.
 *-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
void							NWS_PROMPT_CONTROL__InfoPrompt_Init(void)
{
	mInfoPrompt.Message = NWS_PROMPT_COMMON__MSG__NONE;
	return;
}
/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 * @brief:	This function flags to show the info prompt.
 * @param:	vMessage - Message to display.
 * @retval:	None.
 *-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
void							NWS_PROMPT_CONTROL__InfoPrompt_FlagToShowIt(NWS_PROMPT_COMMON__MESSAGE vMessage)
{
	// Start timeout timer
	GENTIMDT__StartTimer_TB_1SEC( NWS_PROMPT_CONTROL__AUTO_EXIT_DELAY_INTERVAL_1S, &mInfoPrompt.AutoExitDelayTimingCounter );

	mInfoPrompt.Message = vMessage;
	return;
}
/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 * @brief:	Indicates if the info prompt has to be displayed.
 * @param:	None.
 * @retval:	bool.
 *-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
bool							NWS_PROMPT_CONTROL__InfoPrompt_bShowIt(void)
{
	return (bool)( mInfoPrompt.Message != NWS_PROMPT_COMMON__MSG__NONE );
}
/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 * @brief:	Checks if info prompt was being displayed - Note that this is a one shot activity.
 * @param:	None.
 * @retval:	bool.
 *-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
bool							NWS_PROMPT_CONTROL__InfoPrompt_bWasBeingDisplayed(void)
{
	bool		bWasBeingDisplayed = mInfoPrompt.bWasBeingDisplayed;

	mInfoPrompt.bWasBeingDisplayed = false;

	return bWasBeingDisplayed;
}
/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 * @brief:	After info prompt no longer displayed indicates if Yes button pressed.
 * @param:	None.
 * @retval:	bool.
 *-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
bool							NWS_PROMPT_CONTROL__InfoPrompt_bButtonPressedYes(void)
{
	return (bool)( mInfoPrompt.UserAccess.Control.ButtonPressed == NWS_PROMPT_COMMON__CB__PROMPT_YES );
}
/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 * @brief:	User interface update - Information prompt.
 * @param:	None.
 * @retval:	None.
 *-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
void							NWS_PROMPT_CONTROL__UserifUpdate(void)
{
	// Clear any button press
	mInfoPrompt.UserAccess.Control.ButtonPressed = NWS_PROMPT_COMMON__CB__NONE_PRESSED;
	// Flag was being displayed, emilio 21-12-15
	mInfoPrompt.bWasBeingDisplayed = true;
	//
	// User inteface update
#if (BUILD_INFO__NCX_DEVICE == COM_DEFN__NCX_DEVICE__NC7)
	NWS_PROMPT_USERIF_NC7__UpdateDisplay( &mInfoPrompt );
	NWS_PROMPT_USERIF_NC7__UpdateControl( &mInfoPrompt );
#endif
	//
	// Process any control actions
	switch ( mInfoPrompt.UserAccess.Control.ButtonPressed )
	{
		case NWS_PROMPT_COMMON__CB__BACK:
		case NWS_PROMPT_COMMON__CB__PROMPT_OK:
		case NWS_PROMPT_COMMON__CB__PROMPT_NO:
			mInfoPrompt.Message = NWS_PROMPT_COMMON__MSG__NONE;
			break;

		case NWS_PROMPT_COMMON__CB__PROMPT_YES:
			mInfoPrompt.Message = NWS_PROMPT_COMMON__MSG__NONE;
			break;

		default:
			break;
	}

	if ( mInfoPrompt.AutoExitDelayTimingCounter.ulValue == 0 ) { mInfoPrompt.Message = NWS_PROMPT_COMMON__MSG__NONE; }

	return;
}
//*********************************************************************************************************************************************************************************
